import { describe, it, expect, vi } from 'vitest';
import { {{ name | pascal_case }}Handler } from '../{{ name | snake_case }}-handler';

describe('{{ name | pascal_case }}Handler', () => {
  const handler = new {{ name | pascal_case }}Handler();

  const mockContext = {
    taskUuid: crypto.randomUUID(),
    stepUuid: crypto.randomUUID(),
    inputData: { key: 'value' },
    dependencyResults: {},
    stepConfig: {},
    stepInputs: {},
    retryCount: 0,
    maxRetries: 3,
    correlationId: crypto.randomUUID(),
    handlerName: '{{ name | snake_case }}',
    event: {} as any,
    getDependencyResult: vi.fn(),
    getInput: vi.fn(),
  } as any;

  describe('call', () => {
    it('returns a success result', async () => {
      const result = await handler.call(mockContext);

      expect(result.success).toBe(true);
      expect(result.result?.processed).toBe(true);
    });
  });

  describe('metadata', () => {
    it('has the correct handler name', () => {
      expect({{ name | pascal_case }}Handler.handlerName).toBe('{{ name | snake_case }}');
    });

    it('has a version', () => {
      expect({{ name | pascal_case }}Handler.handlerVersion).toBe('1.0.0');
    });
  });
});
