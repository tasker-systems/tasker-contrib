import { describe, it, expect, vi } from 'vitest';
import {
  {{ name | pascal_case }}AnalyzerHandler,
  {{ name | pascal_case }}WorkerHandler,
  {{ name | pascal_case }}ConvergenceHandler,
} from '../{{ name | snake_case }}-handler';

describe('{{ name | pascal_case }}AnalyzerHandler', () => {
  const handler = new {{ name | pascal_case }}AnalyzerHandler();

  describe('analyzer mode', () => {
    it('creates batch configs', async () => {
      const context = {
        taskUuid: crypto.randomUUID(),
        stepUuid: crypto.randomUUID(),
        inputData: { total_items: 1000 },
        dependencyResults: {},
        stepConfig: {},
        stepInputs: {},
        retryCount: 0,
        maxRetries: 3,
        correlationId: crypto.randomUUID(),
        handlerName: '{{ name | snake_case }}_analyzer',
        event: {} as any,
        getDependencyResult: vi.fn(),
        getInput: vi.fn((key: string) => {
          if (key === 'total_items') return 1000;
          return undefined;
        }),
      } as any;

      const result = await handler.call(context);

      expect(result.success).toBe(true);
      expect(result.result?.batch_processing_outcome).toBeDefined();
    });
  });
});

describe('{{ name | pascal_case }}WorkerHandler', () => {
  const handler = new {{ name | pascal_case }}WorkerHandler();

  describe('metadata', () => {
    it('has the correct handler name', () => {
      expect({{ name | pascal_case }}WorkerHandler.handlerName).toBe('{{ name | snake_case }}_worker');
    });
  });
});

describe('{{ name | pascal_case }}ConvergenceHandler', () => {
  describe('metadata', () => {
    it('has the correct handler name', () => {
      expect({{ name | pascal_case }}ConvergenceHandler.handlerName).toBe('{{ name | snake_case }}_convergence');
    });
  });
});
