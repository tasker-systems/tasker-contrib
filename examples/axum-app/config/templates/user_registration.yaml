name: user_registration
namespace_name: microservices_rs
version: 1.0.0

task_handler:
  callable: "user_registration"

input_schema:
  type: object
  required:
    - user_email
    - user_name
  properties:
    user_email:
      type: string
      format: email
    user_name:
      type: string
    plan:
      type: string
      enum: [free, pro, enterprise]
      default: free

steps:
  - name: create_user_account
    description: Validate email, generate user ID, and create account record
    handler:
      callable: "microservices_create_user_account"
    dependencies: []
    retry:
      max_attempts: 2
      backoff_seconds: [1, 5]

  # Diamond pattern: setup_billing_profile and initialize_preferences run in parallel
  - name: setup_billing_profile
    description: Configure billing profile based on plan tier
    handler:
      callable: "microservices_setup_billing_profile"
    dependencies:
      - create_user_account
    retry:
      max_attempts: 3
      backoff_seconds: [2, 10, 30]

  - name: initialize_preferences
    description: Set default preferences and feature flags for the plan
    handler:
      callable: "microservices_initialize_preferences"
    dependencies:
      - create_user_account
    retry:
      max_attempts: 2
      backoff_seconds: [1, 5]

  # Convergence point: both parallel branches must complete
  - name: send_welcome_sequence
    description: Send multi-channel welcome messages to the new user
    handler:
      callable: "microservices_send_welcome_sequence"
    dependencies:
      - setup_billing_profile
      - initialize_preferences
    retry:
      max_attempts: 3
      backoff_seconds: [5, 15, 30]

  - name: update_user_status
    description: Activate the user account after onboarding completes
    handler:
      callable: "microservices_update_user_status"
    dependencies:
      - send_welcome_sequence
    retry:
      max_attempts: 2
      backoff_seconds: [2, 10]
