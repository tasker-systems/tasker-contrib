---
# Customer Success Refund Processing
# 5 sequential steps owned by the Customer Success team
# Namespace: customer_success

name: customer_success_process_refund
namespace: customer_success
version: "1.0.0"
description: "Customer Success team refund workflow: validate, check policy, approve, execute, update ticket"

step_templates:
  - name: cs_validate_refund_request
    description: "Validate the refund request is well-formed"
    handler:
      callable: app.handlers.customer_success.ValidateRefundRequestHandler
      initialization: {}
    depends_on_step_name: []
    retry:
      max_attempts: 3
      backoff_strategy: exponential
      backoff_base_seconds: 2

  - name: cs_check_refund_policy
    description: "Check refund request against company policies"
    handler:
      callable: app.handlers.customer_success.CheckRefundPolicyHandler
      initialization: {}
    depends_on_step_name:
      - cs_validate_refund_request
    retry:
      max_attempts: 3
      backoff_strategy: exponential
      backoff_base_seconds: 2

  - name: cs_approve_refund
    description: "Approve the refund based on policy results"
    handler:
      callable: app.handlers.customer_success.ApproveRefundHandler
      initialization: {}
    depends_on_step_name:
      - cs_validate_refund_request
      - cs_check_refund_policy
    retry:
      max_attempts: 3
      backoff_strategy: exponential
      backoff_base_seconds: 2

  - name: cs_execute_refund
    description: "Execute the approved refund transaction"
    handler:
      callable: app.handlers.customer_success.ExecuteRefundHandler
      initialization: {}
    depends_on_step_name:
      - cs_approve_refund
    retry:
      max_attempts: 3
      backoff_strategy: exponential
      backoff_base_seconds: 5

  - name: cs_update_ticket
    description: "Update the support ticket with resolution"
    handler:
      callable: app.handlers.customer_success.UpdateTicketHandler
      initialization: {}
    depends_on_step_name:
      - cs_execute_refund
    retry:
      max_attempts: 3
      backoff_strategy: exponential
      backoff_base_seconds: 2

input_schema:
  type: object
  properties:
    order_ref:
      type: string
    reason:
      type: string
    amount:
      type: number
    customer_email:
      type: string
  required:
    - order_ref
    - amount
    - customer_email
