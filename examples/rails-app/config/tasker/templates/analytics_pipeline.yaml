name: analytics_pipeline
namespace_name: data_pipeline
version: 1.0.0

task_handler:
  callable: "DataPipeline::AnalyticsPipelineHandler"

input_schema:
  type: object
  required:
    - source
    - date_range
  properties:
    source:
      type: string
      enum: [production, staging, warehouse]
    date_range:
      type: object
      required: [start_date, end_date]
      properties:
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
    filters:
      type: object
      properties:
        region:
          type: string
        product_category:
          type: string
        min_revenue:
          type: number

steps:
  - name: extract_sales_data
    description: Extract raw sales transaction data from the source system
    handler:
      callable: "DataPipeline::StepHandlers::ExtractSalesDataHandler"
    dependencies: []
    retry:
      max_attempts: 3
      backoff_seconds: [5, 15, 30]

  - name: extract_inventory_data
    description: Extract current inventory snapshot data
    handler:
      callable: "DataPipeline::StepHandlers::ExtractInventoryDataHandler"
    dependencies: []
    retry:
      max_attempts: 3
      backoff_seconds: [5, 15, 30]

  - name: extract_customer_data
    description: Extract customer demographic and behavior data
    handler:
      callable: "DataPipeline::StepHandlers::ExtractCustomerDataHandler"
    dependencies: []
    retry:
      max_attempts: 3
      backoff_seconds: [5, 15, 30]

  - name: transform_sales
    description: Clean, normalize, and aggregate sales data
    handler:
      callable: "DataPipeline::StepHandlers::TransformSalesHandler"
    dependencies:
      - extract_sales_data
    retry:
      max_attempts: 2
      backoff_seconds: [5, 15]

  - name: transform_inventory
    description: Calculate stock levels, reorder points, and turnover
    handler:
      callable: "DataPipeline::StepHandlers::TransformInventoryHandler"
    dependencies:
      - extract_inventory_data
    retry:
      max_attempts: 2
      backoff_seconds: [5, 15]

  - name: transform_customers
    description: Segment customers and compute engagement metrics
    handler:
      callable: "DataPipeline::StepHandlers::TransformCustomersHandler"
    dependencies:
      - extract_customer_data
    retry:
      max_attempts: 2
      backoff_seconds: [5, 15]

  - name: aggregate_metrics
    description: Combine all transforms into unified cross-source metrics
    handler:
      callable: "DataPipeline::StepHandlers::AggregateMetricsHandler"
    dependencies:
      - transform_sales
      - transform_inventory
      - transform_customers
    retry:
      max_attempts: 2
      backoff_seconds: [10, 30]

  - name: generate_insights
    description: Generate actionable business insights and recommendations
    handler:
      callable: "DataPipeline::StepHandlers::GenerateInsightsHandler"
    dependencies:
      - aggregate_metrics
    retry:
      max_attempts: 2
      backoff_seconds: [5, 15]
