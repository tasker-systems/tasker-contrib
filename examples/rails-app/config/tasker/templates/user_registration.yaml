name: user_registration
namespace_name: microservices
version: 1.0.0

task_handler:
  callable: "Microservices::UserRegistrationHandler"

input_schema:
  type: object
  required:
    - email
    - name
    - plan
  properties:
    email:
      type: string
      format: email
    name:
      type: string
      minLength: 1
    plan:
      type: string
      enum: [free, pro, enterprise]
    referral_code:
      type: string
    marketing_consent:
      type: boolean
      default: false

steps:
  - name: create_user_account
    description: Validate input and create the user account
    handler:
      callable: "Microservices::StepHandlers::CreateUserAccountHandler"
    dependencies: []
    retry:
      max_attempts: 2
      backoff_seconds: [1, 5]

  - name: setup_billing_profile
    description: Configure billing profile based on the selected plan
    handler:
      callable: "Microservices::StepHandlers::SetupBillingProfileHandler"
    dependencies:
      - create_user_account
    retry:
      max_attempts: 3
      backoff_seconds: [2, 10, 30]

  - name: initialize_preferences
    description: Set up default user preferences based on plan tier
    handler:
      callable: "Microservices::StepHandlers::InitializePreferencesHandler"
    dependencies:
      - create_user_account
    retry:
      max_attempts: 2
      backoff_seconds: [1, 5]

  - name: send_welcome_sequence
    description: Send multi-channel welcome notifications
    handler:
      callable: "Microservices::StepHandlers::SendWelcomeSequenceHandler"
    dependencies:
      - setup_billing_profile
      - initialize_preferences
    retry:
      max_attempts: 3
      backoff_seconds: [5, 15, 30]

  - name: update_user_status
    description: Finalize registration and mark user as active
    handler:
      callable: "Microservices::StepHandlers::UpdateUserStatusHandler"
    dependencies:
      - send_welcome_sequence
    retry:
      max_attempts: 2
      backoff_seconds: [2, 10]
