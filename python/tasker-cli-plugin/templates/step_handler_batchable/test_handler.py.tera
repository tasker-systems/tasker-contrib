"""Tests for {{ name | snake_case }} batch processing handlers."""

import uuid
from unittest.mock import MagicMock

import pytest
from {{ module_name }}.{{ name | snake_case }}_handler import (
    {{ name | snake_case }}_analyzer,
    {{ name | snake_case }}_worker,
    {{ name | snake_case }}_convergence,
)


class TestAnalyzer:
    @pytest.fixture
    def handler(self):
        return {{ name | snake_case }}_analyzer._handler_class()

    def test_creates_batch_configs(self, handler):
        context = MagicMock()
        context.task_uuid = uuid.uuid4()
        context.step_uuid = uuid.uuid4()
        context.get_input = MagicMock(side_effect=lambda key: {
            "total_items": 1000,
        }.get(key))
        context.get_dependency_result = MagicMock(return_value=None)
        context.step_config = {}

        result = handler.call(context)

        assert result.success is True
        outcome = result.result["batch_processing_outcome"]
        assert outcome["type"] == "create_batches"


class TestWorker:
    @pytest.fixture
    def handler(self):
        return {{ name | snake_case }}_worker._handler_class()

    def test_handler_name_is_set(self, handler):
        assert handler.handler_name == "{{ name | snake_case }}_worker"


class TestConvergence:
    @pytest.fixture
    def handler(self):
        return {{ name | snake_case }}_convergence._handler_class()

    def test_handler_name_is_set(self, handler):
        assert handler.handler_name == "{{ name | snake_case }}_convergence"
