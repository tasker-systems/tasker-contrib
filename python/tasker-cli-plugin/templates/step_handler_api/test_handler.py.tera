"""Tests for {{ name | pascal_case }}Handler."""

import uuid
from unittest.mock import MagicMock, patch

import pytest
from {{ module_name }}.{{ name | snake_case }}_handler import {{ name | pascal_case }}Handler


@pytest.fixture
def handler():
    return {{ name | pascal_case }}Handler()


@pytest.fixture
def context():
    ctx = MagicMock()
    ctx.task_uuid = uuid.uuid4()
    ctx.step_uuid = uuid.uuid4()
    ctx.get_input = MagicMock(side_effect=lambda key: "/users/1" if key == "endpoint" else None)
    ctx.step_config = {}
    ctx.retry_count = 0
    ctx.max_retries = 3
    return ctx


class TestCall:
    def test_returns_success_on_200(self, handler, context):
        mock_response = MagicMock()
        mock_response.ok = True
        mock_response.status_code = 200
        mock_response.body = {"id": 1, "name": "Test"}
        mock_response.headers = {"content-type": "application/json"}

        with patch.object(handler, "get", return_value=mock_response):
            result = handler.call(context)

        assert result.success is True

    def test_returns_failure_on_500(self, handler, context):
        mock_response = MagicMock()
        mock_response.ok = False
        mock_response.status_code = 500
        mock_response.is_retryable = True
        mock_response.is_client_error = False
        mock_response.is_server_error = True
        mock_response.headers = {}
        mock_response.body = None
        mock_response.retry_after = None

        with patch.object(handler, "get", return_value=mock_response):
            result = handler.call(context)

        assert result.success is False
