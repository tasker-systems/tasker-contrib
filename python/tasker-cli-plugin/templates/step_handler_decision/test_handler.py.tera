"""Tests for {{ name | snake_case }} decision routing."""

import uuid
from unittest.mock import MagicMock

import pytest
from {{ module_name }}.{{ name | snake_case }}_handler import {{ name | snake_case }}


@pytest.fixture
def handler():
    return {{ name | snake_case }}._handler_class()


def make_context(route_key=None):
    ctx = MagicMock()
    ctx.task_uuid = uuid.uuid4()
    ctx.step_uuid = uuid.uuid4()
    ctx.get_input = MagicMock(side_effect=lambda key: {
        "route_key": route_key,
    }.get(key))
    ctx.get_dependency_result = MagicMock(return_value=None)
    ctx.step_config = {}
    ctx.retry_count = 0
    ctx.max_retries = 3
    return ctx


class TestDecisionRouting:
    def test_fast_track_route(self, handler):
        context = make_context("fast_track")
        result = handler.call(context)

        assert result.success is True
        assert "fast_track_processing" in result.result["decision_point_outcome"]["step_names"]

    def test_review_required_route(self, handler):
        context = make_context("review_required")
        result = handler.call(context)

        assert result.success is True
        step_names = result.result["decision_point_outcome"]["step_names"]
        assert "manual_review" in step_names
        assert "approval_gate" in step_names

    def test_default_route(self, handler):
        context = make_context()
        result = handler.call(context)

        assert result.success is True
        assert "standard_processing" in result.result["decision_point_outcome"]["step_names"]
